I"½<h1 id="ç³»ç»Ÿä¸­æ–°å¢é™æ€ipè®¾ç½®">ç³»ç»Ÿä¸­æ–°å¢é™æ€ipè®¾ç½®</h1>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>æœ¬æ–‡ä¸»è¦ç›®çš„æ˜¯å¼€å‘æä¾›ç»™åº”ç”¨å¼€å‘ä½¿ç”¨ä¿®æ”¹è¿æ¥Wifiæˆ–ä»¥å¤ªç½‘æ—¶çš„é™æ€ipè®¾ç½®ï¼Œé‡‡ç”¨å¹¿æ’­çš„æ–¹å¼æ§åˆ¶ï¼Œåœ¨Settingæ˜¯å†…åŒå®ç°æ—¶ä»¿ç…§Settingsåº”ç”¨å†…éƒ¨çš„ä¿®æ”¹æ–¹å¼å®ç°ã€‚  
æ–°å¢ä¸¤ä¸ªå¹¿æ’­ï¼š  
1.com.cyh.wifi_static_ipï¼šwifié™æ€ipè®¾ç½®å¹¿æ’­
2.com.cyh.eth_static_ipï¼šä»¥å¤ªç½‘é™æ€ipè®¾ç½®å¹¿æ’­
åœ¨Settingså†…æ–°å¢ä¸€ä¸ªå¹¿æ’­æ¥æ”¶NetworkStaticReceiver.java ## AndroidManifest.xml  åœ¨**AndroidManifest.xml**æ–‡ä»¶å†…æ·»åŠ ä¸Šæˆ‘ä»¬æ–°å¢çš„**NetworkStaticReceiver**å’Œç›¸å…³å¹¿æ’­ ```
</pre></td></tr></tbody></table></code></pre></div></div>
<receiver android:name="NetworkStaticReceiver">
            <intent-filter android:priority="1000">
                <action android:name="com.cyh.wifi_static_ip" />
                <action android:name="com.cyh.eth_static_ip" />
            </intent-filter>
       </receiver>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>ä¹‹åæ¥çœ‹**NetworkStaticReceiver.java**æ–‡ä»¶çš„å†…å®¹
## NetworkStaticReceiver.java
è·¯å¾„ï¼špackages/apps/Settings/src/com/android/settings/NetworkStaticReceiver.javaï¼Œåªå‘é€»è¾‘éƒ¨åˆ†ï¼Œçœç•¥äº†importéƒ¨åˆ†ã€‚
</pre></td></tr></tbody></table></code></pre></div></div>
<p>public class NetworkStaticReceiver extends BroadcastReceiver{
     private final String WIFI_STATIC_IP = â€œcom.cyh.wifi_static_ipâ€;
     private final String ETH_STATIC_IP = â€œcom.cyh.eth_static_ipâ€;
     private final String TAG=â€NetworkStaticReceiverâ€;</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="rouge-code"><pre> @Override
    public void onReceive(Context context, Intent intent){
            String action = intent.getAction();
            switch(action){
                if(WIFI_STATIC_IP.equals(action)){
            //Wi-Fié™æ€è®¾ç½®
             //è·å¾—æ˜¯å¦è®¾ç½®ä¸ºé™æ€æ¨¡å¼
                    boolean isStatic =  intent.getBooleanExtra("Static",false);
                    //è·å–è¿æ¥wifiçš„config
                    WifiManager mWifiManager = (WifiManager)context.getApplicationContext().getSystemService(Context.WIFI_SERVICE);
                    WifiConfiguration config = new WifiConfiguration();
                    WifiInfo connectionInfo= mWifiManager.getConnectionInfo();
                            List&lt;WifiConfiguration&gt; configuredNetworks=mWifiManager.getConfiguredNetworks();
                            for (WifiConfiguration conf : configuredNetworks) {
                                    if (conf.networkId==connectionInfo.getNetworkId()) {
                                            config=conf;
                                            break;
                                    }
                            }
                    if(isStatic){
                             //è·å¾—è®¾ç½®çš„Wi-Fié™æ€ipï¼Œç½‘å…³ï¼ŒDNS1ï¼ŒDNS2
                            String ip = intent.getStringExtra("staticIp");
                            String gateway = intent.getStringExtra("gateway");
                            String dns1 = intent.getStringExtra("dns1");
                            String dns2 = intent.getStringExtra("dns2");
                            //åˆ¤æ–­ä¼ å…¥å‚æ•°æ˜¯å¦ä¸ºç©ºï¼Œç©ºçš„è¯ç»™é»˜è®¤å€¼
                            ip = ip ==null?"192.168.0.123":ip;
                            gateway = gateway ==null?"192.168.1.1":gateway;
                            dns1 = dns1 ==null?"8.8.8.8":dns1;
                            dns2 = dns2 ==null?"8.8.4,4":dns2;
                            //validateIpConfigFieldsç”¨äºéªŒè¯ipï¼Œç½‘ç®¡ï¼Œdns1ï¼Œdns2ï¼Œå¹¶å°†ç›¸å…³è®¾ç½®é¡¹è½¬æ¢æˆStaticIpConfiguration
                            StaticIpConfiguration mStaticIpConfiguration = validateIpConfigFields(ip,gateway,dns1,dns2);
                           
                           if(mStaticIpConfiguration == null){
                                    //è®¾ç½®ç›¸å…³å†…å®¹æœ‰é—®é¢˜æ—¶mStaticIpConfigurationä¼šä¸ºnull
                                    return;
                            }
                            config.setStaticIpConfiguration(mStaticIpConfiguration);
                            mWifiManager.updateNetwork(config);
                            boolean saveConfiguration = mWifiManager.saveConfiguration();
</pre></td></tr></tbody></table></code></pre></div></div>
:ET